# DevBox Environment Configuration
# Copy this file to .env and customize for your environment

# =============================================================================
# CONTAINER CONFIGURATION
# =============================================================================

# Container and image naming
CONTAINER_NAME=devbox
IMAGE_NAME=jclement/devbox:latest

# Restart policy: no, always, on-failure, unless-stopped
RESTART_POLICY=unless-stopped

# =============================================================================
# USER CONFIGURATION
# =============================================================================
# These should match your host user to avoid permission issues

# On macOS/Linux, run: id -u
USER_UID=1000

# On macOS/Linux, run: id -g
USER_GID=1000

# Your username
USERNAME=devbox

# Optional: Set a password for HTTP Basic Auth on all web services
# When set, all web access (code-server, pgweb, mailhog, file browser, status page, and your app)
# will require authentication with username (from USERNAME) and this password.
# SSH remains key-based only regardless of this setting.
# Leave empty for unrestricted web access (recommended for private Tailnets or local development)
PASSWORD=

# =============================================================================
# NETWORKING MODE
# =============================================================================
# Choose between Tailscale (remote access) or Local (port forwarding)

# --- Tailscale Mode (Remote Access) ---
# Generate auth key at: https://login.tailscale.com/admin/settings/keys
# Leave empty to use Local mode instead
TS_AUTHKEY=

# Short hostname for Tailscale - defaults to CONTAINER_NAME if not set
# Only set this if you want a different Tailscale hostname than your container name
# TS_HOSTNAME=my-custom-hostname

# Tailscale domain suffix (e.g., "your-tailnet.ts.net" or "ts.net")
# Full hostname will be: {TS_HOSTNAME}.{TS_SUFFIX}
# Used for TLS certificates - leave empty if not using Tailscale HTTPS
TS_SUFFIX=

# --- Local Mode (Port Forwarding) ---
# Port mappings for local mode
# Change these to avoid conflicts when running multiple instances
SSH_PORT=2200
CADDY_PORT=8400
POSTGRES_PORT=5400

# Examples for multiple instances on same host:
#   Instance 1: SSH_PORT=2200, CADDY_PORT=8400, POSTGRES_PORT=5400
#   Instance 2: SSH_PORT=2210, CADDY_PORT=8410, POSTGRES_PORT=5410
#   Instance 3: SSH_PORT=2220, CADDY_PORT=8420, POSTGRES_PORT=5420

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=devdb

# =============================================================================
# SERVICE CONFIGURATION
# =============================================================================

# Port where your development service runs inside the container
# This is where Caddy will proxy requests to for the root path
DEV_SERVICE_PORT=3000

# =============================================================================
# SSH CONFIGURATION
# =============================================================================

# Full path to SSH private key (public key will be inferred by adding .pub)
# This key will be copied to ~/.ssh/id_devbox inside the container
# Used for:
#   - SSH authentication to this devbox
#   - Git SSH operations (clone, push, pull)
#   - Git commit signing
# Examples:
#   SSH_KEY=~/.ssh/id_ed25519
#   SSH_KEY=~/.ssh/id_rsa
#   SSH_KEY=/Users/yourname/.ssh/id_ecdsa
SSH_KEY=~/.ssh/id_ed25519

# =============================================================================
# OPTIONAL LIFECYCLE HOOKS
# =============================================================================

# Command to run before services start
# Use for environment setup, file generation, etc.
# Example: PRE_STARTUP_CMD="cp .env.example .env"
PRE_STARTUP_CMD=

# SQL file to load into PostgreSQL on first initialization
# Path relative to /workspace
# Example: DB_SEED_FILE="database/seed.sql"
DB_SEED_FILE=

# Command to run after all services are running
# Use for dependency installation, data initialization, etc.
# Example: POST_STARTUP_CMD="npm install && npm run dev"
POST_STARTUP_CMD=

# =============================================================================
# EXAMPLE CONFIGURATIONS
# =============================================================================

# Example 1: Local development (macOS)
# ------------------------------------
# CONTAINER_NAME=myproject-dev
# USER_UID=501
# USER_GID=20
# USERNAME=myuser
# PORT_OFFSET=0
# TS_AUTHKEY=
# DEV_SERVICE_PORT=3000
# POST_STARTUP_CMD="npm install && npm run dev"

# Example 2: Remote development with Tailscale
# --------------------------------------------
# CONTAINER_NAME=dev-myproject
# USER_UID=1000
# USER_GID=1000
# USERNAME=myuser
# TS_AUTHKEY=tskey-auth-xxxxxxxxxxxxxxxxxxxxx
# # TS_HOSTNAME will default to "dev-myproject" (from CONTAINER_NAME)
# TS_SUFFIX=your-tailnet.ts.net
# DEV_SERVICE_PORT=8080
# DB_SEED_FILE="database/seed.sql"
# POST_STARTUP_CMD="bundle install && rails server"

# Example 3: Multiple instances on same host
# ------------------------------------------
# CONTAINER_NAME=project-frontend
# PORT_OFFSET=0      # Ports: 2200, 8400, 5400
# # Another instance would use:
# # CONTAINER_NAME=project-backend
# # PORT_OFFSET=10   # Ports: 2210, 8410, 5410
